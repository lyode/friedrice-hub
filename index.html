<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ec4899">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Fried Rice Shop">
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22Fried%20Rice%20Shop%20-%20Membership%22%2C%22short_name%22%3A%22FriedRice%22%2C%22description%22%3A%22Membership%20Management%20System%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23fdf2f8%22%2C%22theme_color%22%3A%22%23ec4899%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bcharset%3Dutf-8%2C%253Csvg%2520xmlns%253D%2522http%253A//www.w3.org/2000/svg%2522%2520width%253D%2522144%2522%2520height%253D%2522144%2522%2520viewBox%253D%25220%25200%2520144%2520144%2522%2520fill%253D%2522%2523ec4899%2522%253E%253Ctext%2520x%253D%252272%2522%2520y%253D%252280%2522%2520font-size%253D%252260%2522%2520text-anchor%253D%2522middle%2522%2520fill%253D%2522white%2522%253E%25F0%259F%258D%25A1%253C/text%253E%253C/svg%253E%22%2C%22sizes%22%3A%22144x144%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
    
    <title>Fried Rice Shop - Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background-color: #fdf2f8;
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
            padding: 16px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .header p {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .stat-label {
            font-size: 10px;
        }
        
        .tabs {
            background: white;
            border-bottom: 1px solid #f3e8ff;
            display: flex;
        }
        
        .tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: none;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            color: #9ca3af;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            color: #ec4899;
            background: #fdf2f8;
            border-bottom-color: #ec4899;
        }
        
        .tab-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .content {
            padding: 16px;
            padding-bottom: 80px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 12px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #ec4899;
            color: white;
        }
        
        .btn-primary:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }
        
        .member-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 8px;
            position: relative;
        }
        
        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .member-name {
            font-size: 14px;
            font-weight: 500;
            color: #1f2937;
        }
        
        .member-id {
            font-size: 12px;
            color: #6b7280;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-expiring {
            background: #fef3c7;
            color: #92400e;
        }
        
        .member-phone {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 12px;
        }
        
        .stat {
            text-align: center;
            background: #fdf2f8;
            padding: 8px;
            border-radius: 4px;
        }
        
        .stat-value {
            font-weight: 500;
        }
        
        .stat-label-small {
            color: #6b7280;
            font-size: 10px;
        }
        
        .member-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .btn-edit {
            background: #10b981;
            color: white;
        }
        
        .btn-edit:hover {
            background: #059669;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
        }
        
        .btn-delete:hover {
            background: #dc2626;
        }
        
        .metric-card {
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metric-blue { background: #ec4899; }
        .metric-green { background: #be185d; }
        .metric-purple { background: #a21caf; }
        
        .metric-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .metric-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .metric-icon {
            font-size: 24px;
        }
        
        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .alert-text {
            font-size: 14px;
            font-weight: 500;
            color: #92400e;
            margin-left: 8px;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-yellow { background: #f59e0b; color: white; }
        .btn-green { background: #10b981; color: white; }
        .btn-blue { background: #ec4899; color: white; }
        
        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        
        .info-box {
            background: #fdf2f8;
            border: 1px solid #f9a8d4;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
        }
        
        .info-title {
            font-size: 14px;
            font-weight: 500;
            color: #be185d;
            margin-bottom: 8px;
        }
        
        .info-list {
            font-size: 12px;
            color: #be185d;
            line-height: 1.4;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 16px;
            font-weight: bold;
            color: #1f2937;
        }

        .close {
            font-size: 24px;
            font-weight: bold;
            color: #6b7280;
            cursor: pointer;
        }

        .close:hover {
            color: #374151;
        }

        .btn-row-modal {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-cancel {
            background: #6b7280;
            color: white;
        }

        .btn-save {
            background: #10b981;
            color: white;
        }

        .btn-confirm-delete {
            background: #ef4444;
            color: white;
        }

        /* Data Management Styles */
        .data-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .data-title {
            font-size: 14px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .btn-data {
            padding: 10px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-export {
            background: #059669;
            color: white;
        }

        .btn-import {
            background: #dc2626;
            color: white;
        }

        .btn-backup {
            background: #7c3aed;
            color: white;
        }

        .btn-restore {
            background: #ea580c;
            color: white;
        }

        .file-input {
            display: none;
        }

        .data-status {
            font-size: 11px;
            color: #64748b;
            text-align: center;
            padding: 8px;
            background: #f1f5f9;
            border-radius: 4px;
        }

        .auto-save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1001;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">💾 Auto-saved</div>

    <!-- Header -->
    <div class="header">
        <h1>🍚 Fried Rice Shop</h1>
        <p>Membership Management</p>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalMembers">0</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeMembers">0</div>
                <div class="stat-label">Active</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="expiringCount">0</div>
                <div class="stat-label">Expiring</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRevenue">RM0</div>
                <div class="stat-label">Revenue</div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="showTab('add', this)">
            <div class="tab-icon">➕</div>
            <div>Add</div>
        </button>
        <button class="tab" onclick="showTab('branches', this)">
            <div class="tab-icon">🏪</div>
            <div>Branches</div>
        </button>
        <button class="tab" onclick="showTab('list', this)">
            <div class="tab-icon">👥</div>
            <div>List</div>
        </button>
        <button class="tab" onclick="showTab('alerts', this)">
            <div class="tab-icon">🔔</div>
            <div>Alerts</div>
        </button>
        <button class="tab" onclick="showTab('stats', this)">
            <div class="tab-icon">📊</div>
            <div>Stats</div>
        </button>
        <button class="tab" onclick="showTab('data', this)">
            <div class="tab-icon">💾</div>
            <div>Data</div>
        </button>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Add Member Section -->
        <div id="add" class="section active">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;">Add New Member</h2>
            
            <div class="card">
                <div class="form-group">
                    <label class="form-label">Branch *</label>
                    <select class="form-input" id="memberBranch" style="padding: 8px 12px; font-size: 13px;">
                        <option value="">Select a branch first</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" class="form-input" id="memberName" placeholder="Customer name">
                </div>

                <div class="form-group">
                    <label class="form-label">Phone *</label>
                    <input type="tel" class="form-input" id="memberPhone" placeholder="+60xxxxxxxxx">
                </div>

                <div class="form-group">
                    <label class="form-label">Membership Plan *</label>
                    <select class="form-input" id="memberDuration" style="padding: 8px 12px; font-size: 13px;">
                        <option value="1" data-price="30">1 Month - RM30</option>
                        <option value="3" data-price="80">3 Months - RM80 (Save RM10)</option>
                        <option value="6" data-price="150">6 Months - RM150 (Save RM30)</option>
                        <option value="12" data-price="250" selected>12 Months - RM250 (Save RM110) ⭐ Popular</option>
                        <option value="18" data-price="375">18 Months - RM375 (Save RM165)</option>
                        <option value="24" data-price="480">24 Months - RM480 (Save RM240)</option>
                    </select>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 4px; display: flex; justify-content: space-between;">
                        <span>💡 Longer plans = Better savings</span>
                        <span id="priceDisplay" style="font-weight: bold; color: #ec4899;">RM250</span>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="addMember()" id="addMemberBtn">Add Member - RM250</button>
            </div>

            <div class="info-box">
                <div class="info-title">💰 Membership Pricing</div>
                <div class="info-list">
                    <strong>Best Value Plans:</strong><br>
                    • 12 months: RM250 (Save RM110)<br>
                    • 18 months: RM375 (Save RM165)<br>
                    • 24 months: RM480 (Save RM240)<br><br>
                    <strong>Member Benefits:</strong><br>
                    • 10% discount on all dishes<br>
                    • Earn 1 point per RM1 spent<br>
                    • Birthday special + free meal<br>
                    • Priority seating during peak hours
                </div>
            </div>
        </div>

        <!-- Branches Section -->
        <div id="branches" class="section">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;">Branch Management</h2>
            
            <div class="card">
                <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #1f2937;">Add New Branch</h3>
                
                <div class="form-group">
                    <label class="form-label">Branch Name *</label>
                    <input type="text" class="form-input" id="branchName" placeholder="e.g., Subang Branch">
                </div>

                <div class="form-group">
                    <label class="form-label">Location *</label>
                    <input type="text" class="form-input" id="branchLocation" placeholder="e.g., Subang Jaya">
                </div>

                <div class="form-group">
                    <label class="form-label">Manager Name</label>
                    <input type="text" class="form-input" id="branchManager" placeholder="Manager name">
                </div>

                <button class="btn btn-primary" onclick="addBranch()">🏪 Add Branch</button>
            </div>

            <div class="card">
                <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #1f2937;" id="branchListHeader">Active Branches (0)</h3>
                
                <div id="branchList">
                    <!-- Branches will be populated here -->
                </div>
            </div>
        </div>

        <!-- Members List Section -->
        <div id="list" class="section">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;" id="memberListHeader">All Members (0)</h2>
            
            <div class="card" style="margin-bottom: 16px;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label">Filter by Branch</label>
                    <select class="form-input" id="branchFilter" onchange="filterByBranch()" style="padding: 8px 12px; font-size: 13px;">
                        <option value="all">🌐 All Branches</option>
                    </select>
                </div>
            </div>
            
            <div id="membersList">
                <!-- Members will be populated here -->
            </div>
        </div>

        <!-- Alerts Section -->
        <div id="alerts" class="section">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;">Renewal Alerts</h2>
            
            <div id="alertsList">
                <!-- Alerts will be populated here -->
            </div>
        </div>

        <!-- Stats Section -->
        <div id="stats" class="section">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;">Analytics</h2>
            
            <div class="metric-card metric-blue">
                <div>
                    <div class="metric-label">Total Revenue</div>
                    <div class="metric-value" id="statsRevenue">RM0</div>
                </div>
                <div class="metric-icon">📈</div>
            </div>

            <div class="metric-card metric-green">
                <div>
                    <div class="metric-label">Active Rate</div>
                    <div class="metric-value" id="activeRate">0%</div>
                </div>
                <div class="metric-icon">👥</div>
            </div>

            <div class="metric-card metric-purple">
                <div>
                    <div class="metric-label">Average Spent</div>
                    <div class="metric-value" id="averageSpent">RM0</div>
                </div>
                <div class="metric-icon">💳</div>
            </div>

            <div class="card">
                <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #1f2937;">Recent Members</h3>
                <div id="recentMembers">
                    <div style="font-size: 12px; color: #6b7280; text-align: center; padding: 20px;">
                        New members you add will appear here
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Section -->
        <div id="data" class="section">
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 16px; color: #1f2937;">Data Management</h2>
            
            <div class="data-section">
                <div class="data-title">
                    💾 Data Operations
                </div>
                <div class="data-actions">
                    <button class="btn-data btn-export" onclick="exportData()">
                        📤 Export Data
                    </button>
                    <button class="btn-data btn-import" onclick="document.getElementById('importFile').click()">
                        📥 Import Data
                    </button>
                    <button class="btn-data btn-backup" onclick="createBackup()">
                        🔄 Create Backup
                    </button>
                    <button class="btn-data btn-restore" onclick="document.getElementById('restoreFile').click()">
                        ↩️ Restore Backup
                    </button>
                </div>
                <div class="data-status" id="dataStatus">
                    Auto-save enabled • Last saved: Never
                </div>
            </div>

            <div class="card">
                <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #1f2937;">System Information</h3>
                <div style="font-size: 12px; color: #6b7280; line-height: 1.6;">
                    <div style="margin-bottom: 8px;">
                        <strong>Data Storage:</strong> Persistent in-memory storage
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>Auto-save:</strong> Enabled (saves every change)
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>Backup Format:</strong> JSON with timestamp
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>Data Validation:</strong> Active
                    </div>
                    <div>
                        <strong>Session Persistence:</strong> Full data retention
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #1f2937;">Quick Actions</h3>
                <div class="btn-row">
                    <button class="btn-small btn-yellow" onclick="clearAllData()">
                        🗑️ Clear All
                    </button>
                    <button class="btn-small btn-green" onclick="loadSampleData()">
                        📋 Sample Data
                    </button>
                </div>
            </div>

            <!-- Hidden file inputs -->
            <input type="file" id="importFile" class="file-input" accept=".json" onchange="importData(event)">
            <input type="file" id="restoreFile" class="file-input" accept=".json" onchange="restoreBackup(event)">
        </div>
    </div>

    <!-- Edit Member Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">✏️ Edit Member</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Name *</label>
                <input type="text" class="form-input" id="editMemberName" placeholder="Customer name">
            </div>

            <div class="form-group">
                <label class="form-label">Phone *</label>
                <input type="tel" class="form-input" id="editMemberPhone" placeholder="+60xxxxxxxxx">
            </div>

            <div class="form-group">
                <label class="form-label">Branch *</label>
                <select class="form-input" id="editMemberBranch" style="padding: 8px 12px; font-size: 13px;">
                </select>
            </div>

            <div class="btn-row-modal">
                <button class="btn btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-save" onclick="saveEditMember()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Member Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🗑️ Delete Member</h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            
            <p style="margin-bottom: 16px; color: #6b7280; font-size: 14px;">
                Are you sure you want to delete this member? This action cannot be undone.
            </p>
            
            <div id="deleteMemberInfo" style="background: #fef2f2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                <!-- Member info will be populated here -->
            </div>

            <div class="btn-row-modal">
                <button class="btn btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-confirm-delete" onclick="confirmDelete()">Delete Member</button>
            </div>
        </div>
    </div>

    <!-- Edit Branch Modal -->
    <div id="editBranchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🏪 Edit Branch</h3>
                <span class="close" onclick="closeEditBranchModal()">&times;</span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Branch Name *</label>
                <input type="text" class="form-input" id="editBranchName" placeholder="Branch name">
            </div>

            <div class="form-group">
                <label class="form-label">Location *</label>
                <input type="text" class="form-input" id="editBranchLocation" placeholder="Location">
            </div>

            <div class="form-group">
                <label class="form-label">Manager Name</label>
                <input type="text" class="form-input" id="editBranchManager" placeholder="Manager name">
            </div>

            <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-input" id="editBranchStatus" style="padding: 8px 12px; font-size: 13px;">
                    <option value="active">Active</option>
                    <option value="coming_soon">Coming Soon</option>
                    <option value="closed">Temporarily Closed</option>
                </select>
            </div>

            <div class="btn-row-modal">
                <button class="btn btn-cancel" onclick="closeEditBranchModal()">Cancel</button>
                <button class="btn btn-save" onclick="saveEditBranch()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Branch Confirmation Modal -->
    <div id="deleteBranchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🗑️ Delete Branch</h3>
                <span class="close" onclick="closeDeleteBranchModal()">&times;</span>
            </div>
            
            <p style="margin-bottom: 16px; color: #6b7280; font-size: 14px;">
                Are you sure you want to delete this branch? This action cannot be undone.
            </p>
            
            <div class="alert-warning" style="margin-bottom: 16px;">
                <span>⚠️</span>
                <span class="alert-text">All members in this branch will need to be reassigned!</span>
            </div>
            
            <div id="deleteBranchInfo" style="background: #fef2f2; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                <!-- Branch info will be populated here -->
            </div>

            <div class="btn-row-modal">
                <button class="btn btn-cancel" onclick="closeDeleteBranchModal()">Cancel</button>
                <button class="btn btn-confirm-delete" onclick="confirmDeleteBranch()">Delete Branch</button>
            </div>
        </div>
    </div>

    <script>
        // ===========================
        // GLOBAL VARIABLES
        // ===========================

        var memberCount = 0;
        var memberCounter = 1;
        var totalRevenue = 0;
        var currentEditingMemberId = null;
        var currentDeletingMemberId = null;
        var currentEditingBranchId = null;
        var currentDeletingBranchId = null;
        var branchCounter = 1;

        // Data storage objects
        var membersData = {};
        var branchesData = {};

        // ===========================
        // DATA PERSISTENCE SYSTEM
        // ===========================

        class DataManager {
            constructor() {
                this.storageKey = 'fried_rice_shop_data';
                this.lastSaveTime = null;
                this.autoSaveEnabled = true;
                this.initialize();
            }

            initialize() {
                this.loadData();
                this.setupAutoSave();
                console.log('Data Manager initialized');
            }

            saveData() {
                if (!this.autoSaveEnabled) return;

                const data = {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    members: membersData || {},
                    branches: branchesData || {},
                    counters: {
                        memberCounter: memberCounter || 1,
                        branchCounter: branchCounter || 1
                    },
                    stats: {
                        totalRevenue: totalRevenue || 0,
                        memberCount: memberCount || 0
                    }
                };

                // Store in persistent data
                window.persistentData = data;
                this.lastSaveTime = new Date();
                
                this.showAutoSaveIndicator();
                this.updateDataStatus();
                
                console.log('Data saved successfully', data);
            }

            loadData() {
                try {
                    const data = window.persistentData;
                    
                    if (data && data.version) {
                        console.log('Loading saved data...', data);
                        
                        // Restore data
                        membersData = data.members || {};
                        branchesData = data.branches || {};
                        memberCounter = data.counters?.memberCounter || 1;
                        branchCounter = data.counters?.branchCounter || 1;
                        totalRevenue = data.stats?.totalRevenue || 0;
                        memberCount = data.stats?.memberCount || 0;
                        
                        this.lastSaveTime = new Date(data.timestamp);
                        
                        // Rebuild UI
                        this.rebuildUI();
                        
                        console.log('Data loaded successfully');
                        return true;
                    } else {
                        console.log('No saved data found, loading sample data');
                        this.loadDefaultData();
                        return false;
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.loadDefaultData();
                    return false;
                }
            }

            loadDefaultData() {
                // Initialize with sample data
                membersData = {
                    1: { name: 'Sarah Chen', phone: '+60123456789', branch: 'main', spent: 480, joinDate: '2024-01-15', status: 'active' },
                    2: { name: 'Ahmad Rahman', phone: '+60198765432', branch: 'main', spent: 320, joinDate: '2024-02-20', status: 'expiring' },
                    3: { name: 'Priya Sharma', phone: '+60167890123', branch: 'kl', spent: 180, joinDate: '2024-03-10', status: 'active' }
                };

                branchesData = {
                    'main': { 
                        name: 'Main Branch', 
                        location: 'Shah Alam, Selangor', 
                        manager: 'Sarah Lee', 
                        status: 'active',
                        icon: '🏪'
                    },
                    'kl': { 
                        name: 'KL Branch', 
                        location: 'Kuala Lumpur', 
                        manager: 'Ahmad Rahman', 
                        status: 'coming_soon',
                        icon: '🏢'
                    }
                };

                memberCounter = 4;
                branchCounter = 1;
                totalRevenue = 980;
                memberCount = 3;

                this.rebuildUI();
                this.saveData();
            }

            rebuildUI() {
                this.rebuildBranches();
                this.rebuildMembers();
                this.updateAllStats();
                this.updateAllDropdowns();
            }

            rebuildBranches() {
                const branchList = document.getElementById('branchList');
                branchList.innerHTML = '';

                Object.entries(branchesData || {}).forEach(([branchId, branchData]) => {
                    addBranchToList(branchId, branchData.name, branchData.location, branchData.manager, branchData.status);
                });

                updateBranchCount();
            }

            rebuildMembers() {
                const membersList = document.getElementById('membersList');
                membersList.innerHTML = '';

                Object.entries(membersData || {}).forEach(([memberId, memberData]) => {
                    addToMemberListFromData(memberData.name, memberData.phone, memberData.branch, memberData.spent, parseInt(memberId));
                });
            }

            updateAllStats() {
                document.getElementById('totalMembers').textContent = memberCount || 0;
                document.getElementById('activeMembers').textContent = memberCount || 0;
                document.getElementById('totalRevenue').textContent = 'RM' + (totalRevenue || 0);
                document.getElementById('statsRevenue').textContent = 'RM' + (totalRevenue || 0);
                document.getElementById('memberListHeader').textContent = 'All Members (' + (memberCount || 0) + ')';
                
                const activeRate = memberCount > 0 ? Math.round((memberCount / memberCount) * 100) : 0;
                const averageSpent = memberCount > 0 ? Math.round(totalRevenue / memberCount) : 0;
                
                document.getElementById('activeRate').textContent = activeRate + '%';
                document.getElementById('averageSpent').textContent = 'RM' + averageSpent;

                // Update expiring count
                const expiringMembers = Object.values(membersData).filter(member => member.status === 'expiring').length;
                document.getElementById('expiringCount').textContent = expiringMembers;
            }

            updateAllDropdowns() {
                const memberBranchSelect = document.getElementById('memberBranch');
                const editMemberBranchSelect = document.getElementById('editMemberBranch');
                const branchFilter = document.getElementById('branchFilter');

                // Clear existing options
                memberBranchSelect.innerHTML = '<option value="">Select a branch first</option>';
                editMemberBranchSelect.innerHTML = '';
                branchFilter.innerHTML = '<option value="all">🌐 All Branches</option>';

                // Add branches to dropdowns
                Object.entries(branchesData || {}).forEach(([branchId, branchData]) => {
                    const memberOption = document.createElement('option');
                    memberOption.value = branchId;
                    memberOption.textContent = branchData.icon + ' ' + branchData.name + ' (' + branchData.location + ')';
                    memberBranchSelect.appendChild(memberOption);

                    const editOption = memberOption.cloneNode(true);
                    editMemberBranchSelect.appendChild(editOption);

                    const filterOption = document.createElement('option');
                    filterOption.value = branchId;
                    filterOption.textContent = branchData.icon + ' ' + branchData.name;
                    branchFilter.appendChild(filterOption);
                });
            }

            setupAutoSave() {
                setInterval(() => {
                    if (this.autoSaveEnabled) {
                        this.saveData();
                    }
                }, 5000);
            }

            showAutoSaveIndicator() {
                const indicator = document.getElementById('autoSaveIndicator');
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }

            updateDataStatus() {
                const status = document.getElementById('dataStatus');
                if (status && this.lastSaveTime) {
                    const timeStr = this.lastSaveTime.toLocaleTimeString();
                    status.textContent = `Auto-save enabled • Last saved: ${timeStr}`;
                }
            }

            getCurrentData() {
                return {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    members: membersData || {},
                    branches: branchesData || {},
                    counters: {
                        memberCounter: memberCounter || 1,
                        branchCounter: branchCounter || 1
                    },
                    stats: {
                        totalRevenue: totalRevenue || 0,
                        memberCount: memberCount || 0
                    }
                };
            }

            exportData() {
                const data = window.persistentData || this.getCurrentData();
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `fried_rice_shop_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('✅ Data exported successfully!');
            }

            createBackup() {
                const data = this.getCurrentData();
                data.backup = true;
                data.backupDate = new Date().toISOString();
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `fried_rice_backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('✅ Backup created successfully!');
            }

            importData(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (this.validateData(data)) {
                            window.persistentData = data;
                            this.loadData();
                            alert('✅ Data imported successfully!');
                        } else {
                            alert('❌ Invalid data format. Please check your file.');
                        }
                    } catch (error) {
                        console.error('Import error:', error);
                        alert('❌ Error importing data. Please check your file format.');
                    }
                };
                reader.readAsText(file);
            }

            validateData(data) {
                return data && 
                       data.version && 
                       typeof data.members === 'object' && 
                       typeof data.branches === 'object';
            }

            clearAllData() {
                if (confirm('⚠️ Are you sure you want to clear ALL data?\n\nThis will delete all members, branches, and reset all statistics.\n\nThis action cannot be undone!')) {
                    window.persistentData = null;
                    membersData = {};
                    branchesData = {};
                    memberCounter = 1;
                    branchCounter = 1;
                    totalRevenue = 0;
                    memberCount = 0;
                    
                    this.rebuildUI();
                    this.saveData();
                    
                    alert('✅ All data cleared successfully!');
                }
            }

            loadSampleData() {
                if (confirm('Load sample data? This will replace current data.')) {
                    this.loadDefaultData();
                    alert('✅ Sample data loaded successfully!');
                }
            }
        }

        // Initialize data manager
        var dataManager = new DataManager();

        // ===========================
        // UTILITY FUNCTIONS
        // ===========================

        function showTab(tabName, tabElement) {
            // Hide all sections
            var sections = document.querySelectorAll('.section');
            sections.forEach(function(section) {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            var tabs = document.querySelectorAll('.tab');
            tabs.forEach(function(tab) {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            tabElement.classList.add('active');

            // Refresh content based on tab
            if (tabName === 'alerts') {
                refreshAlerts();
            } else if (tabName === 'stats') {
                refreshStats();
            }
        }

        function updatePriceDisplay() {
            var durationSelect = document.getElementById('memberDuration');
            var price = durationSelect.options[durationSelect.selectedIndex].getAttribute('data-price');
            document.getElementById('priceDisplay').textContent = 'RM' + price;
            document.getElementById('addMemberBtn').textContent = 'Add Member - RM' + price;
        }

        function updateStats(price) {
            memberCount++;
            totalRevenue += price;
            dataManager.updateAllStats();
        }

        function updateBranchCount() {
            const currentCount = document.querySelectorAll('#branchList .member-card').length;
            document.getElementById('branchListHeader').textContent = 'Active Branches (' + currentCount + ')';
        }

        function filterByBranch() {
            var selectedBranch = document.getElementById('branchFilter').value;
            var memberCards = document.querySelectorAll('#membersList .member-card');
            
            memberCards.forEach(function(card) {
                if (selectedBranch === 'all' || card.getAttribute('data-branch') === selectedBranch) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function refreshAlerts() {
            const alertsList = document.getElementById('alertsList');
            alertsList.innerHTML = '';

            // Find expiring members
            const expiringMembers = Object.entries(membersData).filter(([id, member]) => member.status === 'expiring');

            if (expiringMembers.length === 0) {
                alertsList.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">✅</div>
                        <h3 style="font-size: 16px; color: #10b981; margin-bottom: 8px;">All Good!</h3>
                        <p style="font-size: 14px; color: #6b7280;">No memberships expiring soon.</p>
                    </div>
                `;
                return;
            }

            // Show warning
            alertsList.innerHTML = `
                <div class="alert-warning">
                    <span>⚠️</span>
                    <span class="alert-text">${expiringMembers.length} membership(s) expiring soon</span>
                </div>
            `;

            // Show each expiring member
            expiringMembers.forEach(([memberId, memberData]) => {
                const branchData = branchesData[memberData.branch];
                const branchName = branchData ? branchData.name : 'Unknown Branch';

                alertsList.innerHTML += `
                    <div class="member-card" style="border: 1px solid #fbbf24;">
                        <div class="member-header">
                            <div style="display: flex; align-items: center;">
                                <div style="width: 32px; height: 32px; background: #fef3c7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                    <span style="color: #f59e0b;">⏰</span>
                                </div>
                                <div>
                                    <div class="member-name">${memberData.name}</div>
                                    <div class="member-id">${memberData.phone} • ${branchName}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 16px; font-weight: bold; color: #f59e0b;">15</div>
                                <div style="font-size: 10px; color: #6b7280;">days</div>
                            </div>
                        </div>
                        
                        <div class="stats-row" style="margin: 12px 0;">
                            <div class="stat">
                                <div class="stat-value">${Math.max(1, Math.round(memberData.spent / 40))}</div>
                                <div class="stat-label-small">Visits</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">RM${memberData.spent}</div>
                                <div class="stat-label-small">Spent</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${Math.round(memberData.spent * 0.5)}</div>
                                <div class="stat-label-small">Points</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-small btn-yellow" style="width: 100%; margin-bottom: 8px;">
                            🔔 Send Reminder
                        </button>
                        <div class="btn-row">
                            <button class="btn-small btn-green">✅ Renew</button>
                            <button class="btn-small btn-blue">🎁 Offer</button>
                        </div>
                    </div>
                `;
            });
        }

        function refreshStats() {
            const recentList = document.getElementById('recentMembers');
            
            // Get recent members (last 5 added)
            const sortedMembers = Object.entries(membersData)
                .sort((a, b) => parseInt(b[0]) - parseInt(a[0]))
                .slice(0, 5);

            if (sortedMembers.length === 0) {
                recentList.innerHTML = `
                    <div style="font-size: 12px; color: #6b7280; text-align: center; padding: 20px;">
                        New members you add will appear here
                    </div>
                `;
                return;
            }

            recentList.innerHTML = '';
            sortedMembers.forEach(([memberId, memberData]) => {
                recentList.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f3f4f6;">
                        <div>
                            <div style="font-size: 12px; font-weight: 500;">${memberData.name}</div>
                            <div style="font-size: 10px; color: #6b7280;">${memberData.phone}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; font-weight: 500; color: #ec4899;">RM${memberData.spent}</div>
                            <div style="font-size: 10px; color: #6b7280;">${memberData.joinDate || 'Recent'}</div>
                        </div>
                    </div>
                `;
            });
        }

        // ===========================
        // MEMBER MANAGEMENT
        // ===========================

        function addMember() {
            var name = document.getElementById('memberName').value.trim();
            var phone = document.getElementById('memberPhone').value.trim();
            var branchSelect = document.getElementById('memberBranch');
            var branch = branchSelect.value;
            var durationSelect = document.getElementById('memberDuration');
            var duration = parseInt(durationSelect.value);
            var price = parseInt(durationSelect.options[durationSelect.selectedIndex].getAttribute('data-price'));
            
            if (!name || !phone || !branch) {
                alert('❌ Please fill in all required fields (Name, Phone, and Branch)');
                return;
            }

            // Check if phone already exists
            var existingMember = Object.values(membersData).find(member => member.phone === phone);
            if (existingMember) {
                alert('❌ A member with this phone number already exists!');
                return;
            }
            
            // Store member data
            membersData[memberCounter] = { 
                name: name, 
                phone: phone, 
                branch: branch, 
                spent: price,
                joinDate: new Date().toISOString().split('T')[0],
                status: 'active'
            };
            
            // Add to member list
            addToMemberList(name, phone, branch, price, memberCounter);
            
            // Update stats
            updateStats(price);
            
            // Clear form
            document.getElementById('memberName').value = '';
            document.getElementById('memberPhone').value = '';
            document.getElementById('memberBranch').value = '';
            document.getElementById('memberDuration').value = '12';
            updatePriceDisplay();
            
            // Increment counter
            memberCounter++;
            
            // Save data
            dataManager.saveData();
            
            // Show success message
            var branchText = branchSelect.options[branchSelect.selectedIndex].text;
            alert('✅ Member Added Successfully!\n\nName: ' + name + '\nPhone: ' + phone + '\nBranch: ' + branchText + '\nPlan: ' + duration + ' months\nPrice: RM' + price + '\n\nWelcome to Fried Rice Club! 🍚');
        }

        function addToMemberList(name, phone, branch, price, memberId) {
            var membersList = document.getElementById('membersList');
            var branchData = branchesData[branch];
            var branchIcon = branchData ? branchData.icon + ' ' + branchData.name : '🏪 Unknown Branch';
            var memberIdStr = 'M' + String(memberId).padStart(3, '0');
            
            var memberHTML = 
                '<div class="member-card" data-branch="' + branch + '" data-member-id="' + memberId + '">' +
                    '<div class="member-header">' +
                        '<div>' +
                            '<div class="member-name">' + name + '</div>' +
                            '<div class="member-id">' + memberIdStr + ' • ' + branchIcon + '</div>' +
                        '</div>' +
                        '<span class="status-badge status-active">Active</span>' +
                    '</div>' +
                    '<div class="member-phone">📞 ' + phone + '</div>' +
                    '<div class="stats-row">' +
                        '<div class="stat">' +
                            '<div class="stat-value">⭐ 0</div>' +
                            '<div class="stat-label-small">Points</div>' +
                        '</div>' +
                        '<div class="stat">' +
                            '<div class="stat-value">1</div>' +
                            '<div class="stat-label-small">Visits</div>' +
                        '</div>' +
                        '<div class="stat">' +
                            '<div class="stat-value">RM' + price + '</div>' +
                            '<div class="stat-label-small">Spent</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="member-actions">' +
                        '<button class="action-btn btn-edit" onclick="editMember(' + memberId + ')">' +
                            '✏️ Edit' +
                        '</button>' +
                        '<button class="action-btn btn-delete" onclick="deleteMember(' + memberId + ')">' +
                            '🗑️ Delete' +
                        '</button>' +
                    '</div>' +
                '</div>';
            
            membersList.insertAdjacentHTML('beforeend', memberHTML);
        }

        function addToMemberListFromData(name, phone, branch, price, memberId) {
            var membersList = document.getElementById('membersList');
            var branchData = branchesData[branch];
            var branchIcon = branchData ? branchData.icon + ' ' + branchData.name : '🏪 Unknown Branch';
            var memberIdStr = 'M' + String(memberId).padStart(3, '0');
            var memberInfo = membersData[memberId];
            var status = memberInfo?.status || 'active';
            var statusClass = status === 'active' ? 'status-active' : 'status-expiring';
            var statusText = status === 'active' ? 'Active' : 'Expiring Soon';
            
            var memberHTML = 
                '<div class="member-card" data-branch="' + branch + '" data-member-id="' + memberId + '">' +
                    '<div class="member-header">' +
                        '<div>' +
                            '<div class="member-name">' + name + '</div>' +
                            '<div class="member-id">' + memberIdStr + ' • ' + branchIcon + '</div>' +
                        '</div>' +
                        '<span class="status-badge ' + statusClass + '">' + statusText + '</span>' +
                    '</div>' +
                    '<div class="member-phone">📞 ' + phone + '</div>' +
                    '<div class="stats-row">' +
                        '<div class="stat">' +
                            '<div class="stat-value">⭐ ' + Math.round(price * 0.5) + '</div>' +
                            '<div class="stat-label-small">Points</div>' +
                        '</div>' +
                        '<div class="stat">' +
                            '<div class="stat-value">' + Math.max(1, Math.round(price / 40)) + '</div>' +
                            '<div class="stat-label-small">Visits</div>' +
                        '</div>' +
                        '<div class="stat">' +
                            '<div class="stat-value">RM' + price + '</div>' +
                            '<div class="stat-label-small">Spent</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="member-actions">' +
                        '<button class="action-btn btn-edit" onclick="editMember(' + memberId + ')">' +
                            '✏️ Edit' +
                        '</button>' +
                        '<button class="action-btn btn-delete" onclick="deleteMember(' + memberId + ')">' +
                            '🗑️ Delete' +
                        '</button>' +
                    '</div>' +
                '</div>';
            
            membersList.insertA
