<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fried Rice Club - Enhanced Membership System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .notification-toast.show {
            transform: translateX(0);
        }
        @media (max-width: 640px) {
            .notification-toast {
                right: 10px;
                left: 10px;
                transform: translateY(-100px);
            }
            .notification-toast.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast bg-white rounded-lg shadow-lg border p-4 max-w-sm">
        <div class="flex items-start">
            <div id="toastIcon" class="flex-shrink-0 mr-3"></div>
            <div class="flex-1">
                <p id="toastMessage" class="text-sm font-medium text-gray-800"></p>
                <p id="toastSubMessage" class="text-xs text-gray-500 mt-1"></p>
            </div>
            <button onclick="hideNotification()" class="flex-shrink-0 ml-3 text-gray-400 hover:text-gray-600">√ó</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-3 sm:p-6 min-h-screen">
        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-xl shadow-lg p-4 sm:p-8 mb-4 sm:mb-6 text-white">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                <div>
                    <h1 class="text-xl sm:text-3xl font-bold mb-2">üçö Fried Rice Shop</h1>
                    <p class="text-orange-100 text-sm sm:text-base">Membership Management</p>
                </div>
                <div class="flex items-center space-x-2 mt-2 sm:mt-0">
                    <button onclick="showQuickActions()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-2 rounded-lg text-sm font-medium transition-all">
                        ‚ö° Quick Actions
                    </button>
                    <button onclick="toggleDarkMode()" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-lg transition-all">
                        üåô
                    </button>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 gap-3 sm:grid-cols-4 sm:gap-4">
                <div class="bg-white bg-opacity-20 rounded-lg p-3 sm:p-4 hover:bg-opacity-30 transition-all cursor-pointer" onclick="setActiveTab('tracking')">
                    <div class="text-lg sm:text-2xl font-bold" id="totalMembers">0</div>
                    <div class="text-xs sm:text-sm text-orange-100">Total Members</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 sm:p-4 hover:bg-opacity-30 transition-all cursor-pointer" onclick="setActiveTab('tracking')">
                    <div class="text-lg sm:text-2xl font-bold" id="activeMembers">0</div>
                    <div class="text-xs sm:text-sm text-orange-100">Active Members</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 sm:p-4 hover:bg-opacity-30 transition-all cursor-pointer" onclick="setActiveTab('analytics')">
                    <div class="text-lg sm:text-2xl font-bold" id="totalRevenue">RM0</div>
                    <div class="text-xs sm:text-sm text-orange-100">Total Revenue</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-3 sm:p-4 hover:bg-opacity-30 transition-all cursor-pointer pulse-animation" onclick="setActiveTab('renewals')" id="expiringCard">
                    <div class="text-lg sm:text-2xl font-bold" id="expiringCount">0</div>
                    <div class="text-xs sm:text-sm text-orange-100">Expiring Soon</div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-4 sm:mb-6">
            <div class="flex border-b overflow-x-auto">
                <button onclick="setActiveTab('activation')" id="tab-activation" class="px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm border-b-2 border-orange-500 text-orange-600 min-w-0 flex-shrink-0">
                    üë• <span class="hidden sm:inline">Member</span> Activation
                </button>
                <button onclick="setActiveTab('tracking')" id="tab-tracking" class="px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm text-gray-500 hover:text-gray-700 min-w-0 flex-shrink-0">
                    üìÖ <span class="hidden sm:inline">Membership</span> Tracking
                </button>
                <button onclick="setActiveTab('renewals')" id="tab-renewals" class="px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm text-gray-500 hover:text-gray-700 min-w-0 flex-shrink-0">
                    üîî <span class="hidden sm:inline">Renewal</span> Alerts (<span id="renewalCount">0</span>)
                </button>
                <button onclick="setActiveTab('analytics')" id="tab-analytics" class="px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm text-gray-500 hover:text-gray-700 min-w-0 flex-shrink-0">
                    üìä Analytics
                </button>
                <button onclick="setActiveTab('reports')" id="tab-reports" class="px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm text-gray-500 hover:text-gray-700 min-w-0 flex-shrink-0">
                    üìã Reports
                </button>
            </div>

            <!-- Tab Content -->
            <div id="tabContent">
                <!-- Content will be loaded here -->
            </div>
        </div>

        <!-- Member Details Modal -->
        <div id="memberModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4 z-40" style="display: none;">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto slide-up">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">Member Details</h3>
                        <button onclick="closeMemberModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                </div>
                
                <div id="memberModalContent" class="p-6">
                    <!-- Member details will be loaded here -->
                </div>
                
                <div class="p-6 border-t bg-gray-50">
                    <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                        <button onclick="closeMemberModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100">
                            Close
                        </button>
                        <button onclick="editMember()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            Edit Member
                        </button>
                        <button onclick="deleteMember()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                            Delete Member
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Modal -->
        <div id="quickActionsModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4 z-40" style="display: none;">
            <div class="bg-white rounded-lg max-w-md w-full slide-up">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">Quick Actions</h3>
                        <button onclick="hideQuickActions()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="quickAddMember()" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-center">
                            <div class="text-2xl mb-2">üë§</div>
                            <div class="text-sm font-medium">Add Member</div>
                        </button>
                        <button onclick="bulkImport()" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-center">
                            <div class="text-2xl mb-2">üìÅ</div>
                            <div class="text-sm font-medium">Bulk Import</div>
                        </button>
                        <button onclick="sendBulkSMS()" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-center">
                            <div class="text-2xl mb-2">üì±</div>
                            <div class="text-sm font-medium">Bulk SMS</div>
                        </button>
                        <button onclick="generateReport()" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-center">
                            <div class="text-2xl mb-2">üìä</div>
                            <div class="text-sm font-medium">Generate Report</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var activeTab = 'activation';
        var searchTerm = '';
        var selectedMember = null;
        var isDarkMode = false;
        
        var members = [
            {
                id: 'M001',
                name: 'Sarah Chen',
                phone: '+60123456789',
                email: 'sarah@email.com',
                address: 'Shah Alam, Selangor',
                branch: 'Shah Alam Central',
                joinDate: '2024-01-15',
                expiryDate: '2025-01-15',
                duration: '12 months',
                price: 250,
                status: 'Active',
                points: 450,
                visits: 12,
                totalSpent: 480.50,
                lastVisit: '2024-06-10',
                favoriteItems: ['Special Fried Rice', 'Seafood Fried Rice']
            },
            {
                id: 'M002',
                name: 'Ahmad Rahman',
                phone: '+60198765432',
                email: 'ahmad@email.com',
                address: 'Petaling Jaya, Selangor',
                branch: 'PJ SS2 Branch',
                joinDate: '2024-02-20',
                expiryDate: '2025-02-20',
                duration: '12 months',
                price: 250,
                status: 'Expiring Soon',
                points: 280,
                visits: 8,
                totalSpent: 320.00,
                lastVisit: '2024-06-05',
                favoriteItems: ['Chicken Fried Rice']
            },
            {
                id: 'M003',
                name: 'Priya Sharma',
                phone: '+60167890123',
                email: 'priya@email.com',
                address: 'Subang Jaya, Selangor',
                branch: 'Subang Parade',
                joinDate: '2024-03-10',
                expiryDate: '2025-09-10',
                duration: '18 months',
                price: 375,
                status: 'Active',
                points: 150,
                visits: 5,
                totalSpent: 180.00,
                lastVisit: '2024-06-12',
                favoriteItems: ['Vegetable Fried Rice', 'Tom Yam Fried Rice']
            }
        ];

        var membershipPlans = [
            { duration: '1', months: 1, price: 30, label: '1 Month - RM30' },
            { duration: '3', months: 3, price: 80, label: '3 Months - RM80', savings: 'Save RM10' },
            { duration: '6', months: 6, price: 150, label: '6 Months - RM150', savings: 'Save RM30' },
            { duration: '12', months: 12, price: 250, label: '12 Months - RM250', savings: 'Save RM110', popular: true },
            { duration: '18', months: 18, price: 375, label: '18 Months - RM375', savings: 'Save RM165' },
            { duration: '24', months: 24, price: 480, label: '24 Months - RM480', savings: 'Save RM240' }
        ];

        var newMember = {
            name: '',
            phone: '',
            email: '',
            address: '',
            branch: '',
            duration: '12'
        };

        function showNotification(message, subMessage, type) {
            type = type || 'success';
            var icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            document.getElementById('toastIcon').textContent = icons[type];
            document.getElementById('toastMessage').textContent = message;
            document.getElementById('toastSubMessage').textContent = subMessage || '';
            
            var toast = document.getElementById('notificationToast');
            toast.classList.add('show');
            
            setTimeout(function() {
                hideNotification();
            }, 4000);
        }

        function hideNotification() {
            document.getElementById('notificationToast').classList.remove('show');
        }

        function loadData() {
            updateStats();
            renderCurrentTab();
        }

        function updateStats() {
            var totalMembers = members.length;
            var activeMembers = members.filter(function(m) { return m.status === 'Active'; }).length;
            var totalRevenue = members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0);
            var expiringMembers = getExpiringMembers();

            document.getElementById('totalMembers').textContent = totalMembers;
            document.getElementById('activeMembers').textContent = activeMembers;
            document.getElementById('totalRevenue').textContent = 'RM' + totalRevenue;
            document.getElementById('expiringCount').textContent = expiringMembers.length;
            document.getElementById('renewalCount').textContent = expiringMembers.length;
            
            // Pulse animation for expiring members
            var expiringCard = document.getElementById('expiringCard');
            if (expiringMembers.length > 0) {
                expiringCard.classList.add('pulse-animation');
            } else {
                expiringCard.classList.remove('pulse-animation');
            }
        }

        function getDaysToExpiry(expiryDate) {
            var today = new Date();
            var expiry = new Date(expiryDate);
            var diffTime = expiry - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getExpiringMembers() {
            return members.filter(function(member) {
                var daysToExpiry = getDaysToExpiry(member.expiryDate);
                return daysToExpiry <= 30 && daysToExpiry > 0;
            });
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Active': return 'bg-green-100 text-green-800';
                case 'Expiring Soon': return 'bg-yellow-100 text-yellow-800';
                case 'Expired': return 'bg-red-100 text-red-800';
                case 'Inactive': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function setActiveTab(tab) {
            activeTab = tab;
            
            // Update tab styles
            var tabs = ['activation', 'tracking', 'renewals', 'analytics', 'reports'];
            for (var i = 0; i < tabs.length; i++) {
                var tabElement = document.getElementById('tab-' + tabs[i]);
                if (tabs[i] === tab) {
                    tabElement.className = 'px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm border-b-2 border-orange-500 text-orange-600 min-w-0 flex-shrink-0';
                } else {
                    tabElement.className = 'px-3 sm:px-6 py-3 font-medium whitespace-nowrap text-xs sm:text-sm text-gray-500 hover:text-gray-700 min-w-0 flex-shrink-0';
                }
            }
            
            renderCurrentTab();
        }

        function renderCurrentTab() {
            var content = '';
            switch(activeTab) {
                case 'activation':
                    content = renderActivationTab();
                    break;
                case 'tracking':
                    content = renderTrackingTab();
                    break;
                case 'renewals':
                    content = renderRenewalsTab();
                    break;
                case 'analytics':
                    content = renderAnalyticsTab();
                    break;
                case 'reports':
                    content = renderReportsTab();
                    break;
            }
            document.getElementById('tabContent').innerHTML = content;
        }

        function renderActivationTab() {
            var selectedPlan = membershipPlans.find(function(plan) { return plan.duration === newMember.duration; });
            
            var html = '<div class="p-3 sm:p-6">';
            html += '<div class="space-y-6">';
            
            // Mobile-first single column layout
            html += '<div class="space-y-6">';
            html += '<h2 class="text-lg sm:text-xl font-bold text-gray-800">New Member Registration</h2>';
            html += '<div class="space-y-4">';
            
            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>';
            html += '<input type="text" id="memberName" value="' + newMember.name + '" onchange="updateNewMember(\'name\', this.value)" class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="Enter customer name">';
            html += '</div>';

            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>';
            html += '<input type="tel" id="memberPhone" value="' + newMember.phone + '" onchange="updateNewMember(\'phone\', this.value)" class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="+60xxxxxxxxx">';
            html += '</div>';

            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-2">Branch Name *</label>';
            html += '<select id="memberBranch" onchange="updateNewMember(\'branch\', this.value)" class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">';
            html += '<option value="">Select Branch</option>';
            var branches = ['Shah Alam Central', 'PJ SS2 Branch', 'Subang Parade', 'KLCC Branch', 'Sunway Pyramid', 'One Utama'];
            for (var i = 0; i < branches.length; i++) {
                var selected = newMember.branch === branches[i] ? 'selected' : '';
                html += '<option value="' + branches[i] + '" ' + selected + '>' + branches[i] + '</option>';
            }
            html += '</select>';
            html += '</div>';

            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>';
            html += '<input type="email" id="memberEmail" value="' + newMember.email + '" onchange="updateNewMember(\'email\', this.value)" class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="customer@email.com">';
            html += '</div>';

            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-2">Address (Optional)</label>';
            html += '<input type="text" id="memberAddress" value="' + newMember.address + '" onchange="updateNewMember(\'address\', this.value)" class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="City, State">';
            html += '</div>';

            html += '<div>';
            html += '<label class="block text-sm font-medium text-gray-700 mb-3">Membership Plan *</label>';
            html += '<div class="space-y-3">';
            
            for (var i = 0; i < membershipPlans.length; i++) {
                var plan = membershipPlans[i];
                var isSelected = newMember.duration === plan.duration;
                var borderClass = isSelected ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:border-gray-300';
                var ringClass = plan.popular ? 'ring-2 ring-orange-200' : '';
                
                html += '<div class="relative border-2 rounded-lg p-4 cursor-pointer transition-all ' + borderClass + ' ' + ringClass + ' touch-manipulation" onclick="updateNewMember(\'duration\', \'' + plan.duration + '\')">';
                if (plan.popular) {
                    html += '<div class="absolute -top-2 left-4 bg-orange-500 text-white px-2 py-1 rounded text-xs font-medium">Most Popular</div>';
                }
                html += '<div class="flex items-center justify-between">';
                html += '<div class="flex items-center">';
                html += '<input type="radio" name="duration" value="' + plan.duration + '" ' + (isSelected ? 'checked' : '') + ' onchange="updateNewMember(\'duration\', this.value)" class="text-orange-500 w-4 h-4">';
                html += '<div class="ml-3">';
                html += '<div class="font-medium text-gray-800">' + plan.label + '</div>';
                if (plan.savings) {
                    html += '<div class="text-sm text-green-600 font-medium">' + plan.savings + '</div>';
                }
                html += '</div></div>';
                html += '<div class="text-right">';
                html += '<div class="text-lg font-bold text-orange-600">RM' + plan.price + '</div>';
                html += '<div class="text-xs text-gray-500">RM' + Math.round(plan.price/plan.months) + '/month</div>';
                html += '</div></div></div>';
            }
            
            html += '</div></div>';

            var buttonDisabled = !newMember.name || !newMember.phone || !newMember.branch;
            var buttonClass = buttonDisabled ? 'bg-gray-300 cursor-not-allowed touch-manipulation' : 'bg-orange-500 hover:bg-orange-600 active:bg-orange-700 touch-manipulation';
            
            html += '<button onclick="addNewMember()" ' + (buttonDisabled ? 'disabled' : '') + ' class="w-full ' + buttonClass + ' text-white py-4 px-4 rounded-lg font-medium text-base transition-colors">';
            html += '‚ûï Activate Membership - RM' + (selectedPlan ? selectedPlan.price : 0);
            html += '</button>';

            html += '</div></div>';

            // Membership Benefits
            html += '<div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mt-6">';
            html += '<h4 class="font-medium text-blue-800 mb-3">üéÅ Membership Benefits:</h4>';
            html += '<div class="text-sm text-blue-700 space-y-1">';
            html += '<div>‚Ä¢ 10% discount on all fried rice dishes</div>';
            html += '<div>‚Ä¢ Earn 1 point for every RM1 spent</div>';
            html += '<div>‚Ä¢ Free upgrade to premium ingredients</div>';
            html += '<div>‚Ä¢ Priority seating during peak hours</div>';
            html += '<div>‚Ä¢ Birthday special - Free meal</div>';
            html += '<div>‚Ä¢ Monthly exclusive recipes newsletter</div>';
            html += '</div></div>';

            html += '</div></div>';
            return html;
        }

        function renderTrackingTab() {
            var filteredMembers = members.filter(function(member) {
                return member.name.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1 ||
                       member.phone.indexOf(searchTerm) !== -1 ||
                       member.id.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1;
            });

            var html = '<div class="p-3 sm:p-6">';
            html += '<div class="flex flex-col gap-4 mb-6">';
            html += '<h2 class="text-lg sm:text-xl font-bold text-gray-800">All Members (' + filteredMembers.length + ')</h2>';
            html += '<div class="flex flex-col sm:flex-row gap-3">';
            html += '<div class="relative flex-1">';
            html += '<span class="absolute left-3 top-4 text-gray-400">üîç</span>';
            html += '<input type="text" placeholder="Search members..." value="' + searchTerm + '" onchange="updateSearchTerm(this.value)" class="w-full pl-10 pr-4 py-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">';
            html += '</div>';
            html += '<div class="flex gap-2">';
            html += '<button onclick="exportMembers()" class="bg-green-500 hover:bg-green-600 active:bg-green-700 text-white px-4 py-3 rounded-lg text-sm font-medium touch-manipulation">üì• Export</button>';
            html += '<button onclick="printMemberList()" class="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm font-medium touch-manipulation">üñ®Ô∏è Print</button>';
            html += '</div></div></div>';

            // Filter buttons
            html += '<div class="flex flex-wrap gap-2 mb-6">';
            var statuses = ['All', 'Active', 'Expiring Soon', 'Expired', 'Inactive'];
            for (var i = 0; i < statuses.length; i++) {
                var status = statuses[i];
                var count = status === 'All' ? members.length : members.filter(function(m) { return m.status === status; }).length;
                html += '<button onclick="filterByStatus(\'' + status + '\')" class="px-3 py-2 text-sm rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors">';
                html += status + ' (' + count + ')';
                html += '</button>';
            }
            html += '</div>';

            // Mobile-optimized member cards
            html += '<div class="space-y-4">';
            
            for (var i = 0; i < filteredMembers.length; i++) {
                var member = filteredMembers[i];
                var daysToExpiry = getDaysToExpiry(member.expiryDate);
                
                html += '<div class="bg-white rounded-lg shadow p-4 border hover:shadow-md transition-shadow">';
                html += '<div class="flex items-start justify-between mb-3">';
                html += '<div class="flex-1">';
                html += '<div class="font-medium text-gray-800 text-base">' + member.name + '</div>';
                html += '<div class="text-sm text-gray-500 font-mono">' + member.id + '</div>';
                if (member.branch) {
                    html += '<div class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded mt-1 inline-block">' + member.branch + '</div>';
                }
                html += '</div>';
                html += '<span class="px-2 py-1 rounded-full text-xs font-medium ' + getStatusColor(member.status) + '">' + member.status + '</span>';
                html += '</div>';
                
                html += '<div class="grid grid-cols-2 gap-3 text-sm mb-3">';
                html += '<div>';
                html += '<div class="text-gray-600">üìû ' + member.phone + '</div>';
                if (member.email) {
                    html += '<div class="text-gray-600">‚úâÔ∏è ' + member.email + '</div>';
                }
                html += '</div>';
                html += '<div>';
                html += '<div class="text-gray-600">‚≠ê ' + member.points + ' pts</div>';
                html += '<div class="text-gray-600">üéØ ' + member.visits + ' visits</div>';
                html += '</div>';
                html += '</div>';
                
                html += '<div class="flex items-center justify-between">';
                html += '<div class="text-sm">';
                html += '<div class="font-medium">üí∞ RM' + member.totalSpent.toFixed(2) + '</div>';
                html += '<div class="text-xs ' + (daysToExpiry <= 30 ? 'text-orange-500' : 'text-gray-500') + '">';
                html += daysToExpiry > 0 ? 'Expires in ' + daysToExpiry + ' days' : 'Expired';
                html += '</div></div>';
                html += '<div class="flex items-center space-x-2">';
                html += '<button onclick="callMember(\'' + member.id + '\')" class="text-green-600 hover:text-green-800 p-2 touch-manipulation" title="Call">üìû</button>';
                html += '<button onclick="whatsappMember(\'' + member.id + '\')" class="text-green-600 hover:text-green-800 p-2 touch-manipulation" title="WhatsApp">üí¨</button>';
                html += '<button onclick="viewMemberDetails(\'' + member.id + '\')" class="text-blue-600 hover:text-blue-800 p-2 touch-manipulation" title="View Details">üëÅÔ∏è</button>';
                html += '</div></div>';
                html += '</div>';
            }

            if (filteredMembers.length === 0) {
                html += '<div class="text-center py-8 text-gray-500">';
                html += '<div class="text-4xl mb-2">üîç</div>';
                html += '<p>No members found</p>';
                html += '</div>';
            }

            html += '</div></div>';
            return html;
        }

        function renderRenewalsTab() {
            var expiringMembers = getExpiringMembers();
            
            var html = '<div class="p-3 sm:p-6">';
            html += '<div class="flex flex-col sm:flex-row justify-between items-start gap-4 mb-6">';
            html += '<h2 class="text-lg sm:text-xl font-bold text-gray-800">Membership Renewal Alerts</h2>';
            if (expiringMembers.length > 0) {
                html += '<button onclick="sendAllReminders()" class="bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white px-4 py-3 rounded-lg text-sm font-medium touch-manipulation">Send All Reminders</button>';
            }
            html += '</div>';

            if (expiringMembers.length === 0) {
                html += '<div class="text-center py-12">';
                html += '<div class="text-6xl mb-4">‚úÖ</div>';
                html += '<h3 class="text-lg font-medium text-gray-800 mb-2">All Good!</h3>';
                html += '<p class="text-gray-600">No memberships expiring in the next 30 days.</p>';
                html += '</div>';
            } else {
                html += '<div class="space-y-4">';
                html += '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">';
                html += '<div class="flex items-center">';
                html += '<span class="text-yellow-600 mr-2">‚ö†Ô∏è</span>';
                html += '<span class="font-medium text-yellow-800 text-sm">' + expiringMembers.length + ' membership' + (expiringMembers.length > 1 ? 's' : '') + ' expiring soon</span>';
                html += '</div></div>';

                for (var i = 0; i < expiringMembers.length; i++) {
                    var member = expiringMembers[i];
                    var daysToExpiry = getDaysToExpiry(member.expiryDate);
                    
                    html += '<div class="bg-white border border-yellow-200 rounded-lg p-4 shadow-sm">';
                    html += '<div class="flex items-start justify-between mb-4">';
                    html += '<div class="flex items-start space-x-3 flex-1">';
                    html += '<div class="flex-shrink-0">';
                    html += '<div class="w-10 h-10 rounded-full flex items-center justify-center ' + (daysToExpiry <= 7 ? 'bg-red-100' : 'bg-yellow-100') + '">';
                    html += '<span class="' + (daysToExpiry <= 7 ? 'text-red-600' : 'text-yellow-600') + '">‚è∞</span>';
                    html += '</div></div>';
                    html += '<div class="flex-1 min-w-0">';
                    html += '<h3 class="font-semibold text-gray-800 text-base">' + member.name + '</h3>';
                    html += '<div class="flex flex-wrap items-center gap-2 text-xs text-gray-600 mt-1">';
                    html += '<span>' + member.phone + '</span>';
                    html += '<span>‚Ä¢</span>';
                    html += '<span>' + member.duration + '</span>';
                    if (member.branch) {
                        html += '<span>‚Ä¢ ' + member.branch + '</span>';
                    }
                    html += '</div></div></div>';
                    html += '<div class="text-right flex-shrink-0">';
                    html += '<div class="text-lg font-bold ' + (daysToExpiry <= 7 ? 'text-red-600' : 'text-yellow-600') + '">' + daysToExpiry + '</div>';
                    html += '<div class="text-xs text-gray-500">days</div>';
                    html += '</div></div>';
                    
                    html += '<div class="bg-gray-50 rounded-lg p-3 mb-4">';
                    html += '<div class="grid grid-cols-3 gap-3 text-sm">';
                    html += '<div class="text-center">';
                    html += '<div class="font-semibold text-gray-800">' + member.visits + '</div>';
                    html += '<div class="text-gray-600 text-xs">Visits</div>';
                    html += '</div>';
                    html += '<div class="text-center">';
                    html += '<div class="font-semibold text-gray-800">RM' + member.totalSpent.toFixed(0) + '</div>';
                    html += '<div class="text-gray-600 text-xs">Spent</div>';
                    html += '</div>';
                    html += '<div class="text-center">';
                    html += '<div class="font-semibold text-gray-800">' + member.points + '</div>';
                    html += '<div class="text-gray-600 text-xs">Points</div>';
                    html += '</div>';
                    html += '</div></div>';
                    
                    html += '<div class="flex flex-col sm:flex-row gap-2">';
                    html += '<button onclick="sendReminder(\'' + member.id + '\')" class="bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm font-medium touch-manipulation flex-1">üîî Remind</button>';
                    html += '<button onclick="renewMembership(\'' + member.id + '\', 12)" class="bg-green-500 hover:bg-green-600 active:bg-green-700 text-white px-3 py-2 rounded-lg text-sm font-medium touch-manipulation flex-1">‚úÖ Renew</button>';
                    html += '<button onclick="specialOffer(\'' + member.id + '\')" class="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium touch-manipulation flex-1">üéÅ Offer</button>';
                    html += '</div></div>';
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        function renderAnalyticsTab() {
            var totalMembers = members.length;
            var activeMembers = members.filter(function(m) { return m.status === 'Active'; }).length;
            var totalRevenue = members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0);
            var totalSpent = members.reduce(function(sum, m) { return sum + m.totalSpent; }, 0);
            var averageSpent = totalSpent / totalMembers;
            var expiringCount = getExpiringMembers().length;

            var html = '<div class="p-3 sm:p-6">';
            html += '<h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-6">Membership Analytics</h2>';
            
            html += '<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">';
            
            html += '<div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<p class="text-blue-100 text-sm">Total Revenue</p>';
            html += '<p class="text-xl font-bold">RM' + totalRevenue + '</p>';
            html += '</div>';
            html += '<span class="text-2xl">üìà</span>';
            html += '</div></div>';

            html += '<div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<p class="text-green-100 text-sm">Active Rate</p>';
            html += '<p class="text-xl font-bold">' + ((activeMembers/totalMembers)*100).toFixed(1) + '%</p>';
            html += '</div>';
            html += '<span class="text-2xl">üë•</span>';
            html += '</div></div>';

            html += '<div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<p class="text-purple-100 text-sm">Avg. Spent</p>';
            html += '<p class="text-xl font-bold">RM' + averageSpent.toFixed(0) + '</p>';
            html += '</div>';
            html += '<span class="text-2xl">üí≥</span>';
            html += '</div></div>';

            html += '<div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<p class="text-orange-100 text-sm">Retention Alert</p>';
            html += '<p class="text-xl font-bold">' + expiringCount + '</p>';
            html += '</div>';
            html += '<span class="text-2xl">üîî</span>';
            html += '</div></div>';

            html += '</div>';

            html += '<div class="space-y-6">';
            
            // Membership Status
            html += '<div class="bg-white p-4 rounded-lg shadow">';
            html += '<h3 class="text-base font-semibold text-gray-800 mb-4">Membership Status</h3>';
            html += '<div class="space-y-3">';
            
            var statuses = ['Active', 'Expiring Soon', 'Expired', 'Inactive'];
            for (var i = 0; i < statuses.length; i++) {
                var status = statuses[i];
                var statusMembers = members.filter(function(m) { return m.status === status; }).length;
                var percentage = (statusMembers / totalMembers * 100).toFixed(1);
                
                html += '<div class="flex items-center justify-between">';
                html += '<div class="flex items-center">';
                html += '<span class="px-2 py-1 rounded-full text-xs font-medium ' + getStatusColor(status) + '">' + status + '</span>';
                html += '<span class="ml-3 text-sm text-gray-600">' + statusMembers + ' members</span>';
                html += '</div>';
                html += '<span class="text-sm font-semibold text-gray-800">' + percentage + '%</span>';
                html += '</div>';
            }
            
            html += '</div></div>';

            // Top Spenders
            html += '<div class="bg-white p-4 rounded-lg shadow">';
            html += '<h3 class="text-base font-semibold text-gray-800 mb-4">Top Spenders</h3>';
            html += '<div class="space-y-3">';
            
            var topSpenders = members.sort(function(a, b) { return b.totalSpent - a.totalSpent; }).slice(0, 5);
            for (var i = 0; i < topSpenders.length; i++) {
                var member = topSpenders[i];
                html += '<div class="flex items-center justify-between">';
                html += '<div class="flex items-center">';
                html += '<div class="w-6 h-6 bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-full flex items-center justify-center text-white text-xs font-bold">' + (i + 1) + '</div>';
                html += '<div class="ml-3">';
                html += '<div class="font-medium text-gray-800 text-sm">' + member.name + '</div>';
                html += '<div class="text-xs text-gray-500">' + member.visits + ' visits</div>';
                html += '</div></div>';
                html += '<div class="text-right">';
                html += '<div class="font-semibold text-gray-800 text-sm">RM' + member.totalSpent.toFixed(0) + '</div>';
                html += '<div class="text-xs text-gray-500">' + member.points + ' pts</div>';
                html += '</div></div>';
            }
            
            html += '</div></div>';

            // Branch Performance
            html += '<div class="bg-white p-4 rounded-lg shadow">';
            html += '<h3 class="text-base font-semibold text-gray-800 mb-4">Branch Performance</h3>';
            
            var branches = {};
            for (var i = 0; i < members.length; i++) {
                var branch = members[i].branch || 'Unknown';
                if (!branches[branch]) {
                    branches[branch] = { count: 0, revenue: 0 };
                }
                branches[branch].count++;
                branches[branch].revenue += members[i].price || 0;
            }
            
            html += '<div class="space-y-3">';
            for (var branch in branches) {
                var data = branches[branch];
                html += '<div class="flex items-center justify-between">';
                html += '<div>';
                html += '<div class="font-medium text-gray-800 text-sm">' + branch + '</div>';
                html += '<div class="text-xs text-gray-500">' + data.count + ' members</div>';
                html += '</div>';
                html += '<div class="text-right">';
                html += '<div class="font-semibold text-gray-800 text-sm">RM' + data.revenue + '</div>';
                html += '</div></div>';
            }
            html += '</div></div>';

            html += '</div></div>';
            return html;
        }

        function renderReportsTab() {
            var html = '<div class="p-3 sm:p-6">';
            html += '<h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-6">Reports & Export</h2>';
            
            html += '<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">';
            
            // Quick Reports
            html += '<div class="bg-white p-6 rounded-lg shadow border">';
            html += '<h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Quick Reports</h3>';
            html += '<div class="space-y-3">';
            html += '<button onclick="generateMembershipReport()" class="w-full text-left bg-blue-50 hover:bg-blue-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-blue-800">Membership Summary</div>';
            html += '<div class="text-sm text-blue-600">Overview of all memberships</div>';
            html += '</button>';
            html += '<button onclick="generateExpiringReport()" class="w-full text-left bg-yellow-50 hover:bg-yellow-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-yellow-800">Expiring Members</div>';
            html += '<div class="text-sm text-yellow-600">Members expiring in 30 days</div>';
            html += '</button>';
            html += '<button onclick="generateRevenueReport()" class="w-full text-left bg-green-50 hover:bg-green-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-green-800">Revenue Report</div>';
            html += '<div class="text-sm text-green-600">Financial performance</div>';
            html += '</button>';
            html += '<button onclick="generateBranchReport()" class="w-full text-left bg-purple-50 hover:bg-purple-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-purple-800">Branch Analysis</div>';
            html += '<div class="text-sm text-purple-600">Performance by branch</div>';
            html += '</button>';
            html += '</div></div>';
            
            // Data Export
            html += '<div class="bg-white p-6 rounded-lg shadow border">';
            html += '<h3 class="text-lg font-semibold text-gray-800 mb-4">üìÅ Data Export</h3>';
            html += '<div class="space-y-3">';
            html += '<button onclick="exportToCSV()" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-gray-800">Export to CSV</div>';
            html += '<div class="text-sm text-gray-600">Download member data as CSV</div>';
            html += '</button>';
            html += '<button onclick="exportToJSON()" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-gray-800">Export to JSON</div>';
            html += '<div class="text-sm text-gray-600">Download as JSON format</div>';
            html += '</button>';
            html += '<button onclick="printReport()" class="w-full text-left bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">';
            html += '<div class="font-medium text-gray-800">Print Report</div>';
            html += '<div class="text-sm text-gray-600">Print-friendly format</div>';
            html += '</button>';
            html += '</div></div>';
            
            html += '</div>';
            
            // Recent Activity
            html += '<div class="bg-white p-6 rounded-lg shadow border">';
            html += '<h3 class="text-lg font-semibold text-gray-800 mb-4">üìà Recent Activity</h3>';
            html += '<div class="space-y-3 text-sm">';
            html += '<div class="flex items-center justify-between p-2 bg-green-50 rounded">';
            html += '<span class="text-green-700">New member registration</span>';
            html += '<span class="text-green-600">Today</span>';
            html += '</div>';
            html += '<div class="flex items-center justify-between p-2 bg-yellow-50 rounded">';
            html += '<span class="text-yellow-700">Membership renewal reminder sent</span>';
            html += '<span class="text-yellow-600">Yesterday</span>';
            html += '</div>';
            html += '<div class="flex items-center justify-between p-2 bg-blue-50 rounded">';
            html += '<span class="text-blue-700">Monthly report generated</span>';
            html += '<span class="text-blue-600">3 days ago</span>';
            html += '</div>';
            html += '</div></div>';
            
            html += '</div>';
            return html;
        }

        function updateNewMember(field, value) {
            newMember[field] = value;
            renderCurrentTab();
        }

        function updateSearchTerm(value) {
            searchTerm = value;
            renderCurrentTab();
        }

        function addNewMember() {
            if (newMember.name && newMember.phone && newMember.branch) {
                var memberId = 'M' + String(members.length + 1).padStart(3, '0');
                var today = new Date();
                var expiry = new Date(today);
                expiry.setMonth(expiry.getMonth() + parseInt(newMember.duration));

                var selectedPlan = membershipPlans.find(function(plan) { return plan.duration === newMember.duration; });

                var member = {
                    id: memberId,
                    name: newMember.name,
                    phone: newMember.phone,
                    email: newMember.email,
                    address: newMember.address,
                    branch: newMember.branch,
                    joinDate: today.toISOString().split('T')[0],
                    expiryDate: expiry.toISOString().split('T')[0],
                    duration: newMember.duration + ' months',
                    price: selectedPlan ? selectedPlan.price : 0,
                    status: 'Active',
                    points: 0,
                    visits: 0,
                    totalSpent: 0,
                    lastVisit: null,
                    favoriteItems: []
                };

                members.push(member);
                newMember = { name: '', phone: '', email: '', address: '', branch: '', duration: '12' };
                
                updateStats();
                renderCurrentTab();
                showNotification('Membership activated successfully!', 'Member ID: ' + memberId + ' | Total: RM' + selectedPlan.price, 'success');
            }
        }

        function viewMemberDetails(memberId) {
            selectedMember = members.find(function(m) { return m.id === memberId; });
            if (selectedMember) {
                var html = '';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
                
                html += '<div>';
                html += '<h4 class="font-semibold text-gray-800 mb-3">Personal Information</h4>';
                html += '<div class="space-y-2 text-sm">';
                html += '<div><strong>ID:</strong> ' + selectedMember.id + '</div>';
                html += '<div><strong>Name:</strong> ' + selectedMember.name + '</div>';
                html += '<div><strong>Phone:</strong> ' + selectedMember.phone + '</div>';
                html += '<div><strong>Email:</strong> ' + (selectedMember.email || 'Not provided') + '</div>';
                html += '<div><strong>Address:</strong> ' + (selectedMember.address || 'Not provided') + '</div>';
                html += '<div><strong>Branch:</strong> ' + (selectedMember.branch || 'Not specified') + '</div>';
                html += '</div></div>';
                
                html += '<div>';
                html += '<h4 class="font-semibold text-gray-800 mb-3">Membership Details</h4>';
                html += '<div class="space-y-2 text-sm">';
                html += '<div><strong>Join Date:</strong> ' + selectedMember.joinDate + '</div>';
                html += '<div><strong>Expiry Date:</strong> ' + selectedMember.expiryDate + '</div>';
                html += '<div><strong>Duration:</strong> ' + selectedMember.duration + '</div>';
                html += '<div><strong>Price:</strong> RM' + (selectedMember.price || 0) + '</div>';
                html += '<div><strong>Status:</strong> <span class="ml-2 px-2 py-1 rounded-full text-xs font-medium ' + getStatusColor(selectedMember.status) + '">' + selectedMember.status + '</span></div>';
                html += '</div></div>';
                
                html += '</div>';
                
                html += '<div class="mt-6">';
                html += '<h4 class="font-semibold text-gray-800 mb-3">Activity Summary</h4>';
                html += '<div class="grid grid-cols-4 gap-4 text-center">';
                html += '<div class="bg-blue-50 p-3 rounded-lg">';
                html += '<div class="font-bold text-blue-600">' + selectedMember.points + '</div>';
                html += '<div class="text-xs text-blue-600">Points</div>';
                html += '</div>';
                html += '<div class="bg-green-50 p-3 rounded-lg">';
                html += '<div class="font-bold text-green-600">' + selectedMember.visits + '</div>';
                html += '<div class="text-xs text-green-600">Visits</div>';
                html += '</div>';
                html += '<div class="bg-purple-50 p-3 rounded-lg">';
                html += '<div class="font-bold text-purple-600">RM' + selectedMember.totalSpent.toFixed(2) + '</div>';
                html += '<div class="text-xs text-purple-600">Total Spent</div>';
                html += '</div>';
                html += '<div class="bg-orange-50 p-3 rounded-lg">';
                html += '<div class="font-bold text-orange-600">' + (selectedMember.lastVisit || 'Never') + '</div>';
                html += '<div class="text-xs text-orange-600">Last Visit</div>';
                html += '</div>';
                html += '</div></div>';

                if (selectedMember.favoriteItems && selectedMember.favoriteItems.length > 0) {
                    html += '<div class="mt-6">';
                    html += '<h4 class="font-semibold text-gray-800 mb-3">Favorite Items</h4>';
                    html += '<div class="flex flex-wrap gap-2">';
                    for (var i = 0; i < selectedMember.favoriteItems.length; i++) {
                        html += '<span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs">' + selectedMember.favoriteItems[i] + '</span>';
                    }
                    html += '</div></div>';
                }

                document.getElementById('memberModalContent').innerHTML = html;
                document.getElementById('memberModal').style.display = 'flex';
            }
        }

        function closeMemberModal() {
            document.getElementById('memberModal').style.display = 'none';
        }

        function editMember() {
            if (selectedMember) {
                showNotification('Edit feature coming soon!', 'Member editing functionality will be available in the next update.', 'info');
            }
        }

        function deleteMember() {
            if (selectedMember && confirm('Are you sure you want to delete ' + selectedMember.name + '?')) {
                members = members.filter(function(m) { return m.id !== selectedMember.id; });
                updateStats();
                renderCurrentTab();
                closeMemberModal();
                showNotification('Member deleted successfully!', selectedMember.name + ' has been removed from the system.', 'success');
            }
        }

        function renewMembership(memberId, duration) {
            for (var i = 0; i < members.length; i++) {
                if (members[i].id === memberId) {
                    var newExpiry = new Date();
                    newExpiry.setMonth(newExpiry.getMonth() + duration);
                    members[i].expiryDate = newExpiry.toISOString().split('T')[0];
                    members[i].status = 'Active';
                    break;
                }
            }
            updateStats();
            renderCurrentTab();
            showNotification('Membership renewed successfully!', 'Extended for ' + duration + ' months', 'success');
        }

        function sendReminder(memberId) {
            var member = members.find(function(m) { return m.id === memberId; });
            if (member) {
                showNotification('Reminder sent!', 'WhatsApp reminder sent to ' + member.name, 'success');
            }
        }

        function sendAllReminders() {
            var expiring = getExpiringMembers();
            showNotification('Bulk reminders sent!', 'Sent to ' + expiring.length + ' members with expiring memberships', 'success');
        }

        function specialOffer(memberId) {
            var member = members.find(function(m) { return m.id === memberId; });
            if (member) {
                showNotification('Special offer sent!', '10% renewal discount offered to ' + member.name, 'success');
            }
        }

        function callMember(memberId) {
            var member = members.find(function(m) { return m.id === memberId; });
            if (member) {
                window.open('tel:' + member.phone);
                showNotification('Calling member...', 'Initiating call to ' + member.name, 'info');
            }
        }

        function whatsappMember(memberId) {
            var member = members.find(function(m) { return m.id === memberId; });
            if (member) {
                var message = encodeURIComponent('Hello ' + member.name + ', this is from Fried Rice Shop. How can we help you today?');
                var phone = member.phone.replace(/[^0-9]/g, '');
                if (phone.startsWith('60')) {
                    phone = phone;
                } else if (phone.startsWith('0')) {
                    phone = '60' + phone.substring(1);
                } else {
                    phone = '60' + phone;
                }
                window.open('https://wa.me/' + phone + '?text=' + message);
                showNotification('Opening WhatsApp...', 'Starting conversation with ' + member.name, 'info');
            }
        }

        function filterByStatus(status) {
            searchTerm = '';
            if (status === 'All') {
                renderCurrentTab();
            } else {
                var filteredMembers = members.filter(function(member) {
                    return member.status === status;
                });
                // Update the display with filtered results
                renderCurrentTab();
            }
        }

        function exportMembers() {
            var data = members.map(function(m) {
                return {
                    ID: m.id,
                    Name: m.name,
                    Phone: m.phone,
                    Email: m.email || '',
                    Address: m.address || '',
                    Branch: m.branch || '',
                    Status: m.status,
                    JoinDate: m.joinDate,
                    ExpiryDate: m.expiryDate,
                    Duration: m.duration,
                    Price: m.price,
                    TotalSpent: m.totalSpent,
                    Points: m.points,
                    Visits: m.visits,
                    LastVisit: m.lastVisit || ''
                };
            });
            
            var csv = 'data:text/csv;charset=utf-8,';
            csv += Object.keys(data[0]).join(',') + '\n';
            data.forEach(function(row) {
                csv += Object.values(row).map(function(value) {
                    return '"' + value + '"';
                }).join(',') + '\n';
            });
            
            var link = document.createElement('a');
            link.setAttribute('href', encodeURI(csv));
            link.setAttribute('download', 'members_' + new Date().toISOString().split('T')[0] + '.csv');
            link.click();
            
            showNotification('Export completed!', 'Member data exported to CSV file', 'success');
        }

        function printMemberList() {
            var printWindow = window.open('', '_blank');
            var html = '<html><head><title>Member List - Fried Rice Shop</title>';
            html += '<style>body{font-family:Arial,sans-serif;margin:20px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background-color:#f2f2f2;}</style>';
            html += '</head><body>';
            html += '<h1>üçö Fried Rice Shop - Member List</h1>';
            html += '<p>Generated on: ' + new Date().toLocaleDateString() + '</p>';
            html += '<table>';
            html += '<thead><tr><th>ID</th><th>Name</th><th>Phone</th><th>Branch</th><th>Status</th><th>Expiry Date</th><th>Total Spent</th></tr></thead>';
            html += '<tbody>';
            
            members.forEach(function(member) {
                html += '<tr>';
                html += '<td>' + member.id + '</td>';
                html += '<td>' + member.name + '</td>';
                html += '<td>' + member.phone + '</td>';
                html += '<td>' + (member.branch || '') + '</td>';
                html += '<td>' + member.status + '</td>';
                html += '<td>' + member.expiryDate + '</td>';
                html += '<td>RM' + member.totalSpent.toFixed(2) + '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></body></html>';
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
            
            showNotification('Print ready!', 'Member list prepared for printing', 'success');
        }

        function showQuickActions() {
            document.getElementById('quickActionsModal').style.display = 'flex';
        }

        function hideQuickActions() {
            document.getElementById('quickActionsModal').style.display = 'none';
        }

        function quickAddMember() {
            hideQuickActions();
            setActiveTab('activation');
            showNotification('Quick Add', 'Switched to member activation tab', 'info');
        }

        function bulkImport() {
            hideQuickActions();
            showNotification('Bulk Import', 'Feature coming soon! Upload CSV files to import multiple members.', 'info');
        }

        function sendBulkSMS() {
            hideQuickActions();
            var activeMembers = members.filter(function(m) { return m.status === 'Active'; });
            showNotification('Bulk SMS', 'Would send SMS to ' + activeMembers.length + ' active members', 'info');
        }

        function generateReport() {
            hideQuickActions();
            setActiveTab('reports');
            showNotification('Reports', 'Switched to reports section', 'info');
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            showNotification('Dark Mode', isDarkMode ? 'Dark mode enabled' : 'Light mode enabled', 'info');
        }

        // Reports functions
        function generateMembershipReport() {
            var report = {
                totalMembers: members.length,
                activeMembers: members.filter(function(m) { return m.status === 'Active'; }).length,
                expiringMembers: getExpiringMembers().length,
                totalRevenue: members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0),
                averageSpent: members.reduce(function(sum, m) { return sum + m.totalSpent; }, 0) / members.length
            };
            
            console.log('Membership Report:', report);
            showNotification('Report Generated!', 'Membership summary available in browser console (F12)', 'success');
        }

        function generateExpiringReport() {
            var expiringMembers = getExpiringMembers();
            var report = expiringMembers.map(function(m) {
                return {
                    id: m.id,
                    name: m.name,
                    phone: m.phone,
                    branch: m.branch,
                    expiryDate: m.expiryDate,
                    daysLeft: getDaysToExpiry(m.expiryDate)
                };
            });
            
            console.log('Expiring Members Report:', report);
            showNotification('Expiring Report Generated!', expiringMembers.length + ' members expiring soon. Check console for details.', 'success');
        }

        function generateRevenueReport() {
            var revenue = {
                totalRevenue: members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0),
                totalSpent: members.reduce(function(sum, m) { return sum + m.totalSpent; }, 0),
                averageRevenuePerMember: members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0) / members.length,
                monthlyProjection: members.filter(function(m) { return m.status === 'Active'; }).length * 50 // Estimated monthly spending
            };
            
            console.log('Revenue Report:', revenue);
            showNotification('Revenue Report Generated!', 'Financial data available in console', 'success');
        }

        function generateBranchReport() {
            var branches = {};
            members.forEach(function(member) {
                var branch = member.branch || 'Unknown';
                if (!branches[branch]) {
                    branches[branch] = {
                        memberCount: 0,
                        totalRevenue: 0,
                        totalSpent: 0,
                        activeMembers: 0
                    };
                }
                branches[branch].memberCount++;
                branches[branch].totalRevenue += member.price || 0;
                branches[branch].totalSpent += member.totalSpent;
                if (member.status === 'Active') {
                    branches[branch].activeMembers++;
                }
            });
            
            console.log('Branch Performance Report:', branches);
            showNotification('Branch Report Generated!', 'Performance data by branch available in console', 'success');
        }

        function exportToCSV() {
            exportMembers(); // Reuse existing function
        }

        function exportToJSON() {
            var data = JSON.stringify(members, null, 2);
            var blob = new Blob([data], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'members_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('JSON Export completed!', 'Member data exported as JSON file', 'success');
        }

        function printReport() {
            var printWindow = window.open('', '_blank');
            var totalMembers = members.length;
            var activeMembers = members.filter(function(m) { return m.status === 'Active'; }).length;
            var totalRevenue = members.reduce(function(sum, m) { return sum + (m.price || 0); }, 0);
            var expiringMembers = getExpiringMembers();
            
            var html = '<html><head><title>Membership Report - Fried Rice Shop</title>';
            html += '<style>body{font-family:Arial,sans-serif;margin:20px;}.header{text-align:center;margin-bottom:30px;}.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:20px 0;}.stat-card{border:1px solid #ddd;padding:15px;border-radius:5px;text-align:center;}.stat-number{font-size:24px;font-weight:bold;color:#ff6b35;}.stat-label{color:#666;margin-top:5px;}table{width:100%;border-collapse:collapse;margin-top:20px;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background-color:#f2f2f2;}</style>';
            html += '</head><body>';
            html += '<div class="header">';
            html += '<h1>üçö Fried Rice Shop</h1>';
            html += '<h2>Membership Management Report</h2>';
            html += '<p>Generated on: ' + new Date().toLocaleDateString() + '</p>';
            html += '</div>';
            
            html += '<div class="stats">';
            html += '<div class="stat-card"><div class="stat-number">' + totalMembers + '</div><div class="stat-label">Total Members</div></div>';
            html += '<div class="stat-card"><div class="stat-number">' + activeMembers + '</div><div class="stat-label">Active Members</div></div>';
            html += '<div class="stat-card"><div class="stat-number">RM' + totalRevenue + '</div><div class="stat-label">Total Revenue</div></div>';
            html += '<div class="stat-card"><div class="stat-number">' + expiringMembers.length + '</div><div class="stat-label">Expiring Soon</div></div>';
            html += '</div>';
            
            if (expiringMembers.length > 0) {
                html += '<h3>‚ö†Ô∏è Members Expiring Soon</h3>';
                html += '<table>';
                html += '<thead><tr><th>Name</th><th>Phone</th><th>Branch</th><th>Expiry Date</th><th>Days Left</th></tr></thead>';
                html += '<tbody>';
                
                expiringMembers.forEach(function(member) {
                    html += '<tr>';
                    html += '<td>' + member.name + '</td>';
                    html += '<td>' + member.phone + '</td>';
                    html += '<td>' + (member.branch || '') + '</td>';
                    html += '<td>' + member.expiryDate + '</td>';
                    html += '<td>' + getDaysToExpiry(member.expiryDate) + '</td>';
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
            }
            
            html += '</body></html>';
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
            
            showNotification('Print Report Ready!', 'Comprehensive membership report prepared for printing', 'success');
        }

        // Auto-update member statuses based on expiry dates
        function updateMemberStatuses() {
            var updated = 0;
            members.forEach(function(member) {
                var daysToExpiry = getDaysToExpiry(member.expiryDate);
                var newStatus;
                
                if (daysToExpiry < 0) {
                    newStatus = 'Expired';
                } else if (daysToExpiry <= 30) {
                    newStatus = 'Expiring Soon';
                } else {
                    newStatus = 'Active';
                }
                
                if (member.status !== newStatus) {
                    member.status = newStatus;
                    updated++;
                }
            });
            
            if (updated > 0) {
                updateStats();
                if (activeTab === 'tracking' || activeTab === 'renewals') {
                    renderCurrentTab();
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Alt + 1-5 for tab switching
            if (e.altKey && !e.ctrlKey && !e.shiftKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        setActiveTab('activation');
                        break;
                    case '2':
                        e.preventDefault();
                        setActiveTab('tracking');
                        break;
                    case '3':
                        e.preventDefault();
                        setActiveTab('renewals');
                        break;
                    case '4':
                        e.preventDefault();
                        setActiveTab('analytics');
                        break;
                    case '5':
                        e.preventDefault();
                        setActiveTab('reports');
                        break;
                }
            }
            
            // Escape key to close modals
            if (e.key === 'Escape') {
                closeMemberModal();
                hideQuickActions();
                hideNotification();
            }
        });

        // Auto-refresh every 5 minutes to update member statuses
        setInterval(function() {
            updateMemberStatuses();
        }, 5 * 60 * 1000);

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateMemberStatuses();
            
            // Show welcome notification
            setTimeout(function() {
                showNotification('Welcome to Fried Rice Shop!', 'Membership management system ready', 'success');
            }, 1000);
        });

        // Load data when page loads
        loadData();
